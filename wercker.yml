box: tcnksm/gox@0.1.0
build:
  steps:
    - script:
        name: go get
        code: go get -v -d ./...
    - script:
        name: go vet
        code: go tool vet *.go
    - script:
        name: go lint
        code: |-
          go get github.com/golang/lint/golint
          LINTLINES=$(golint | tee lint_results.txt | wc -l | tr -d " ")
          cat lint_results.txt
          if [ "$LINTLINES" -ge 10 ]; then echo "Time to tidy up: $LINTLINES lint warnings." > $WERCKER_REPORT_MESSAGE_FILE; fail "Time to tidy up."; fi
          if [ "$LINTLINES" -ge 5 ]; then echo "You should be tidying soon: $LINTLINES lint warnings." > $WERCKER_REPORT_MESSAGE_FILE; warn "You should be tidying soon."; fi
          if [ "$LINTLINES" -lt 5 && "$LINTLINES" -gt 0 ]; then echo "You are fairly tidy: $LINTLINES lint warnings." > $WERCKER_REPORT_MESSAGE_FILE; fi
          if [ "$LINTLINES" -eq 0 ]; then echo "Perfect: $LINTLINES lint warnings." > $WERCKER_REPORT_MESSAGE_FILE; fi
    - tcnksm/gox:
        os: "darwin linux"
        arch: "386 amd64"
    - script:
        name: prepare
        code: |-
            echo $WERCKER_GIT_COMMIT > $WERCKER_OUTPUT_DIR/HEAD
            cp -r $WERCKER_OUTPUT_DIR/pkg $WERCKER_OUTPUT_DIR/latest
            cp -r $WERCKER_OUTPUT_DIR/pkg $WERCKER_OUTPUT_DIR/$WERCKER_GIT_COMMIT

deploy:
  steps:
    - s3sync:
        source-dir: "."
        delete-removed: false
        bucket-url: $AWS_BUCKET_URL/$WERCKER_GIT_BRANCH/
        key-id: $AWS_ACCESS_KEY_ID
        key-secret: $AWS_SECRET_ACCESS_KEY
