box: wercker/golang
build:
  steps:
    - setup-go-workspace
    - script:
        name: get dependencies
        code: |-
          go version
          export GOPATH=$WERCKER_SOURCE_DIR:$GOPATH
          ./install_dependencies.sh
    - script:
        name: go vet
        code: |-
          export GOPATH=$WERCKER_SOURCE_DIR
          sudo GOPATH=$WERCKER_SOURCE_DIR /usr/local/go/bin/go get code.google.com/p/go.tools/cmd/vet
          go tool vet *.go
    - script:
        name: go lint
        code: |-
          export GOPATH=$WERCKER_SOURCE_DIR
          export PATH=$PATH:/usr/local/go/bin:$GOPATH/bin
          go get github.com/golang/lint/golint
          golint

deploy:
  steps:
    - script:
        name: build dist
        code: |-
          export GOPATH=$WERCKER_SOURCE_DIR:$GOPATH
          ./install_dependencies.sh
          go build -o ./dist/$WERCKER_GIT_BRANCH/wercker-sentcli
          cp ./dist/$WERCKER_GIT_BRANCH/wercker-sentcli ./dist/$WERCKER_GIT_BRANCH/wercker-sentcli.${WERCKER_GIT_COMMIT:0:8}
    - s3sync:
        source-dir: dist
        delete-removed: false
        bucket-url: s3://wercker-development/sentcli/
        key-id: $AWS_ACCESS_KEY_ID
        key-secret: $AWS_SECRET_ACCESS_KEY
